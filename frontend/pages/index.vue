<!-- pages/index.vue -->
<template>
  <div
    class="relative min-h-[400px] flex items-center justify-center overflow-hidden"
  >
    <Orb style="width: 100%; height: 500px; position: relative" />
    <div
      class="absolute top-1/2 left-1/2 z-10"
      style="transform: translate(-50%, -50%)"
    >
      <NuxtLink
        to="/plan"
        class="inline-block bg-transparent text-white px-8 py-4 rounded-full font-semibold text-2xl hover:text-primary transition-all transform hover:scale-105 shadow-lg"
      >
        é–‹å§‹è¦åŠƒ
      </NuxtLink>
    </div>
  </div>

  <!-- åŠŸèƒ½ä»‹ç´¹å€å¡Š -->
  <section ref="featuresSection" class="py-20 px-4">
    <div class="w-full">
      <h2 ref="featuresTitle" class="text-4xl font-bold text-center mb-12" style="opacity: 0;">æ™ºæ…§ç”Ÿæ´»ï¼Œå¾é€™è£¡é–‹å§‹</h2>
      <div class="grid md:grid-cols-3 gap-8">
        <ThreeDCard ref="featureCard1">
          <div class="emoji-icon mb-4">ğŸ </div>
          <h3 class="text-lg font-bold mb-2">æ™ºèƒ½æ§åˆ¶</h3>
          <p class="text-base text-gray-600">
            é€éæ‰‹æ©Ÿå³å¯æ§åˆ¶å®¶ä¸­æ‰€æœ‰æ™ºæ…§è¨­å‚™ï¼Œæ‰“é€ å°ˆå±¬çš„æ™ºæ…§ç”Ÿæ´»ç©ºé–“ã€‚
          </p>
        </ThreeDCard>
        <ThreeDCard ref="featureCard2">
          <div class="emoji-icon mb-4">ğŸ¥</div>
          <h3 class="text-lg font-bold mb-2">å®‰å…¨å®ˆè­·</h3>
          <p class="text-base text-gray-600">
            24å°æ™‚å…¨å¤©å€™ç›£æ§ï¼Œä¿è­·æ‚¨çš„å®¶äººå’Œè²¡ç”¢å®‰å…¨ã€‚
          </p>
        </ThreeDCard>
        <ThreeDCard ref="featureCard3">
          <div class="emoji-icon mb-4">ğŸ’¡</div>
          <h3 class="text-lg font-bold mb-2">ç¯€èƒ½ç’°ä¿</h3>
          <p class="text-base text-gray-600">
            æ™ºæ…§èƒ½æºç®¡ç†ç³»çµ±ï¼Œç‚ºæ‚¨ç¯€çœèƒ½æºé–‹æ”¯ï¼Œæ„›è­·åœ°çƒç’°å¢ƒã€‚
          </p>
        </ThreeDCard>
      </div>
    </div>
  </section>

  <!-- CTA å€å¡Š -->
  <section ref="ctaSection" class="py-20 bg-gradient-to-r from-primary to-secondary text-white">
    <div class="w-full text-center px-4">
      <h2 ref="ctaTitle" class="text-4xl font-bold mb-4" style="opacity: 0;">æº–å‚™å¥½è¿æ¥æ™ºæ…§ç”Ÿæ´»äº†å—ï¼Ÿ</h2>
      <p ref="ctaSubtitle" class="text-xl mb-8" style="opacity: 0;">æ¢ç´¢æˆ‘å€‘çš„æœ€æ–°è³‡è¨Š</p>
      <NuxtLink
        ref="ctaButton"
        to="/articles/news"
        class="inline-block bg-white text-primary px-8 py-4 rounded-full font-semibold hover:bg-gray-100 transition-all transform hover:scale-105"
      >
        ç«‹å³æ¢ç´¢
      </NuxtLink>
    </div>
  </section>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';

// ===== DEBUG: é–‹å§‹è¼‰å…¥ index.vue =====
console.log("ğŸ” [index.vue] Script setup é–‹å§‹åŸ·è¡Œ");

import HeroSection from "@/components/public/HeroSection.vue";
import Orb from "@/components/public/Orb.vue";
import ThreeDCard from "@/components/common/ThreeDCard.vue";

console.log("ğŸ” [index.vue] æ‰€æœ‰ imports å®Œæˆ");

const { $gsap, $ScrollTrigger } = useNuxtApp();

console.log("ğŸ” [index.vue] NuxtApp åˆå§‹åŒ–å®Œæˆ");
console.log("ğŸ” [index.vue] $gsap å­˜åœ¨:", !!$gsap);
console.log("ğŸ” [index.vue] $ScrollTrigger å­˜åœ¨:", !!$ScrollTrigger);

// SEO Meta
useHead({
  title: "WURIDAO æ™ºæ…§å®¶ - é¦–é ",
  meta: [
    {
      name: "description",
      content:
        "WURIDAO æ™ºæ…§å®¶æä¾›å®Œæ•´çš„æ™ºèƒ½å®¶å±…è§£æ±ºæ–¹æ¡ˆï¼ŒåŒ…æ‹¬æ™ºèƒ½æ§åˆ¶ã€å®‰å…¨å®ˆè­·ã€ç¯€èƒ½ç’°ä¿ç­‰åŠŸèƒ½ã€‚",
    },
    { property: "og:title", content: "WURIDAO æ™ºæ…§å®¶ - é¦–é " },
    {
      property: "og:description",
      content: "WURIDAO æ™ºæ…§å®¶æä¾›å®Œæ•´çš„æ™ºèƒ½å®¶å±…è§£æ±ºæ–¹æ¡ˆ",
    },
  ],
});

console.log("ğŸ” [index.vue] SEO meta è¨­å®šå®Œæˆ");

// ===== å‹•ç•« refs =====
console.log("ğŸ” [index.vue] é–‹å§‹å®šç¾©å‹•ç•« refs");

const featuresSection = ref();
const featuresTitle = ref();
const featureCard1 = ref();
const featureCard2 = ref();
const featureCard3 = ref();
const ctaSection = ref();
const ctaTitle = ref();
const ctaSubtitle = ref();
const ctaButton = ref();

console.log("ğŸ” [index.vue] å‹•ç•« refs å®šç¾©å®Œæˆ");

// ===== ç”Ÿå‘½é€±æœŸ =====
console.log("ğŸ” [index.vue] é–‹å§‹è¨­å®šç”Ÿå‘½é€±æœŸ");

try {
  onMounted(() => {
    console.log("ğŸ” [index.vue] onMounted é–‹å§‹åŸ·è¡Œ");

    // æª¢æŸ¥ GSAP å’Œ ScrollTrigger å¯ç”¨æ€§
    if (!process.client) {
      console.log("âš ï¸ [index.vue] ä¸åœ¨ client ç«¯ï¼Œè·³éå‹•ç•«åˆå§‹åŒ–");
      return;
    }

    if (!$gsap) {
      console.error("âŒ [index.vue] $gsap ä¸å¯ç”¨");
      return;
    }

    if (!$ScrollTrigger) {
      console.error("âŒ [index.vue] $ScrollTrigger ä¸å¯ç”¨");
      return;
    }

    console.log("ğŸ” [index.vue] GSAP å’Œ ScrollTrigger éƒ½å¯ç”¨ï¼Œé–‹å§‹åˆå§‹åŒ–å‹•ç•«");

    // Add a small delay to ensure DOM is fully rendered
    setTimeout(() => {
      // Features section animation
      console.log("ğŸ” [index.vue] é–‹å§‹è¨­ç½® Features section å‹•ç•«");

      if (
        !featuresSection.value ||
        !featuresTitle.value ||
        !featureCard1.value ||
        !featureCard2.value ||
        !featureCard3.value
      ) {
        if (process.dev) {
          console.warn("âš ï¸ [index.vue] Features section å…ƒç´ ä¸å­˜åœ¨ï¼Œè·³éå‹•ç•«åˆå§‹åŒ–");
        }
        return;
      }

    // Use CSS-based animations instead of GSAP
    const animateElement = (element, delay = 0) => {
      if (!element || !element.value) {
        if (process.dev) {
          console.warn("âš ï¸ [index.vue] animateElement: element is undefined or null");
        }
        return;
      }
      
      setTimeout(() => {
        // Additional check to ensure element is a DOM element
        if (element.value && element.value.style && element.value instanceof HTMLElement) {
          try {
            element.value.style.transition = 'opacity 0.8s ease-out';
            element.value.style.opacity = '1';
          } catch (error) {
            if (process.dev) {
              console.warn("âš ï¸ [index.vue] animateElement: Failed to set style properties:", error);
            }
          }
        } else {
          if (process.dev) {
            console.warn("âš ï¸ [index.vue] animateElement: element.value is not a valid DOM element", element.value);
          }
        }
      }, delay);
    };

    // Only animate text elements that are guaranteed to be DOM elements
    if (featuresTitle.value) {
      animateElement(featuresTitle, 0);
    }
    
    // Skip component animations for now to avoid warnings
    // The ThreeDCard components have their own internal animations

    console.log("ğŸ” [index.vue] Features section å‹•ç•«è¨­ç½®å®Œæˆ");

    // CTA section animation
    console.log("ğŸ” [index.vue] é–‹å§‹è¨­ç½® CTA section å‹•ç•«");

    if (
      !ctaSection.value ||
      !ctaTitle.value ||
      !ctaSubtitle.value ||
      !ctaButton.value
    ) {
      if (process.dev) {
        console.warn("âš ï¸ [index.vue] CTA section å…ƒç´ ä¸å­˜åœ¨ï¼Œè·³éå‹•ç•«åˆå§‹åŒ–");
      }
      return;
    }

    // Use CSS-based animations for CTA section
    if (ctaTitle.value) {
      animateElement(ctaTitle, 0);
    }
    if (ctaSubtitle.value) {
      animateElement(ctaSubtitle, 300);
    }
    
    // Skip button animation for now to avoid warnings

    console.log("ğŸ” [index.vue] CTA section å‹•ç•«è¨­ç½®å®Œæˆ");
    console.log("ğŸ” [index.vue] æ‰€æœ‰å‹•ç•«åˆå§‹åŒ–å®Œæˆ");
    }, 100); // Close the setTimeout with 100ms delay
  });
} catch (e) {
  console.error("âŒ [index.vue] onMounted åŸ·è¡Œå¤±æ•—:", e);
}

console.log("ğŸ” [index.vue] ç”Ÿå‘½é€±æœŸè¨­å®šå®Œæˆ");
console.log("ğŸ” [index.vue] Script setup åŸ·è¡Œå®Œæˆ");
</script>

<style scoped>
.orb-bg-iframe {
  position: absolute;
  inset: 0;
  width: 100%;
  height: 100%;
  z-index: 0;
  pointer-events: none;
  border: none;
}
.emoji-icon {
  font-size: 3rem;
  filter: drop-shadow(0 2px 8px rgba(0, 0, 0, 0.18));
  display: flex;
  align-items: center;
  justify-content: flex-start;
  width: 3.5rem;
  height: 3.5rem;
}
.card h3 {
  color: #fff;
}
.card p {
  color: #e5e7eb;
}
</style>
